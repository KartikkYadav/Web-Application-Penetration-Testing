# Session Management

## What is Session Management?

Session Management is the process used by web applications to maintain a user's authenticated state across multiple HTTP requests. Since HTTP is a stateless protocol, session management allows the server to recognize and track a user after login.

---

## Why Session Management Is Important

- Maintains user authentication after login
- Tracks user activity across multiple requests
- Protects sensitive user data
- Prevents unauthorized access and impersonation

---

## What is a Cookie?

- A cookie is a small piece of data sent by a website and stored in a user's web browser while the user is browsing the website.
- Each time the user accesses the website, the browser sends the cookie back to the server to inform the website about the user's previous activity.

**Cookies are also known as:**
- HTTP cookies
- Web cookies
- Browser cookies

---

## Session ID / Session Tokens

A secure session identifier should follow these security best practices:

- Must be random and unpredictable (**high entropy**)
- Minimum length of **128 bits**
- Should be meaningless and not contain encoded user data
- The name should not reveal its purpose (avoid names like `user`, `auth`, `sessionid`)
- Should have a defined timeout and must not be reused
- Must be invalidated immediately on logout
- Must not be derived from shared secrets such as:
  - Username
  - Password
- Must be transmitted only over secure channels (**HTTPS**)
- Session timeout duration should be appropriate based on risk and usage

---

## Where Can Session Identifiers Be Stored?

- URL parameters
- Hidden form fields
- Cookies

---

## Session Persistence in URL Parameters

### Advantages

- Supports multiple simultaneous sessions in the same browser
- Works even if the client does not accept cookies

### Disadvantages

- Session ID is lost once the user leaves the website
- Session ID can leak through the **Referer** header when accessing external resources
- Session ID may be exposed via:
  - Browser history
  - Application logs
  - Proxy and server logs

---

## Session Persistence in Hidden Form Fields

### Advantages

- Supports multiple simultaneous sessions in the same browser
- Works even if the client does not accept cookies

### Disadvantages

- Session ID is lost once the user navigates away from the website
- All requests must be POST-based (session ID is not preserved in GET requests)
- Embedded resources such as images, JavaScript, and CSS cannot be securely handled

---

## Recommended Best Practice

- Use **secure, HTTP-only cookies** for session management
## Session Persistence in Hidden Form Fields

### Advantages
- Supports multiple simultaneous sessions in the same browser  
- Works even if the client does not accept cookies  

### Disadvantages
- Session ID is lost once the user navigates away from the website  
- All requests must be POST-based (session ID is not preserved in GET requests)  
- Embedded resources such as images, JavaScript, and CSS cannot be securely handled  

---

## Recommended Best Practice

- Use **secure, HTTP-only cookies** for session management  
- Enable the following cookie attributes:
  - `Secure`
  - `HttpOnly`
  - `SameSite`
- Regenerate session IDs after authentication and privilege changes  
- Implement proper session expiration and inactivity timeouts  

---

# Cookie Attributes

Cookie attributes provide additional security controls and define how, when, and where cookies are sent by the browser.

---

## Secure

- Ensures the cookie is sent only over encrypted **HTTPS (SSL/TLS)** connections  
- Prevents cookies from being transmitted over unencrypted HTTP  
- Cookies marked as `Secure` are included only in HTTPS requests  

**Example**

    Set-Cookie: session=abc123; Secure

### Domain

- Specifies the domain for which the cookie is valid
- Allows sharing cookies across subdomains when explicitly defined

### Example

    Domain=.armourinfosec.com

### The cookie will be sent to:

- armourinfosec.com

- www.armourinfosec.com

- api.armourinfosec.com

### Path

- Defines the URL path for which the cookie is valid

- The browser sends the cookie only when the request path matches the defined path

### Example

    Path=/

### Cookie is valid for:

- https://www.armourinfosec.com/

- https://www.armourinfosec.com/victim

If the path were:

    Path=/victim

### Cookie would only be sent to:

- https://www.armourinfosec.com/victim

### HttpOnly

- Prevents client-side scripts (JavaScript) from accessing the cookie

- Helps mitigate attacks such as Cross-Site Scripting (XSS)

- Cookies with HttpOnly cannot be read using document.cookie

### Example

    Set-Cookie: session=abc123; HttpOnly

### JavaScript Test (Browser Console)

    document.cookie
    alert(document.cookie)

- HttpOnly cookies will not appear in the output

### Expires

- Used to create persistent cookies

- Defines the date and time when the cookie should expire

- The browser deletes the cookie once the expiration date is reached

### Example

    Expires=Wed, 21 Oct 2026 07:28:00 GMT

If Expires is not set:

- The cookie is treated as a session cookie

- It is deleted when the browser is closed

### Security Best Practice
Always use cookies with:

- Secure

- HttpOnly

- SameSite

## Security Best Practice

- Always use cookies with:
  - `Secure`
  - `HttpOnly`
  - `SameSite`
- Avoid overly broad **Domain** and **Path** values  
- Prefer short expiration times for session cookies  
- Regenerate session cookies after authentication  

---

## References

- OWASP Session Management Cheat Sheet  
- OWASP ASVS  
- OWASP Top 10  

---

# Types of Session Hijacking

Session hijacking is an attack where an attacker takes control of a valid user session by stealing or predicting the session identifier.

---

## 1. Network-Based Session Hijacking

### Packet Sniffing
- Attacker captures network traffic to steal session IDs  
- Common on unsecured or public Wi-Fi networks  
- Occurs when applications do not enforce HTTPS  

**Example**
- Capturing cookies over HTTP using packet sniffing tools  

---

## 2. Client-Side Session Hijacking

### Cross-Site Scripting (XSS)
- Attacker injects malicious JavaScript into a vulnerable page  
- Script steals session cookies using `document.cookie`  
- Effective when cookies are not marked as `HttpOnly`  

### Malicious Browser Extensions
- Rogue or compromised extensions can read cookies and session storage  
- Can exfiltrate session identifiers to attacker-controlled servers  

---

## 3. Session Fixation

- Attacker sets or predicts a valid session ID before user login  
- Victim logs in using the attacker-controlled session ID  
- Attacker reuses the same session ID to access the account  

---

## 4. Man-in-the-Middle (MITM) Attacks

- Attacker intercepts traffic between client and server  
- Can modify or steal session tokens in transit  
- Occurs when HTTPS is not properly enforced or validated  

---

## 5. Cross-Site Request Forgery (CSRF) with Session Abuse

- Attacker performs unauthorized actions using a victimâ€™s active session  
- Exploits automatic cookie transmission by the browser  
- Does not steal the session ID but abuses it  

---

## 6. Session ID Prediction / Brute Force

- Attacker guesses or brute-forces session IDs  
- Happens when session IDs lack sufficient randomness or entropy  

---

## 7. Session Sidejacking

- Attacker captures session cookies from unencrypted requests  
- Especially common when only login is protected by HTTPS  
- Remaining pages use HTTP  

---

## 8. Browser History, Logs, and Referer Leakage

- Session IDs stored in URLs leak via:
  - Browser history  
  - Server or proxy logs  
  - Referer headers when visiting external sites  

---

## 9. Physical Access Hijacking

- Attacker gains access to an unlocked or shared device  
- Uses existing active session without authentication  

---

## Prevention Techniques

- Enforce HTTPS across the entire application  
- Use `Secure`, `HttpOnly`, and `SameSite` cookie attributes  
- Regenerate session IDs after login and privilege changes  
- Implement session expiration and inactivity timeouts  
- Protect against XSS and CSRF  
- Avoid session IDs in URLs  

