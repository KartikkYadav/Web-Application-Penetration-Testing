# XML External Entity (XXE) Injection

## XML eXternal entity (XXE) Injection

*   **XML (eXtensible Markup Language)** is a markup language used for storing and transporting data in a structured, machine-readable format. Unlike HTML, which defines the visual layout of documents, XML defines the data structure and semantics using tags that describe and organize data for easy interpretation and exchange between systems.
*   **XML External Entity (XXE)** injection is a security vulnerability that occurs when an XML parser improperly processes external entities referenced in XML documents. An external entity is a type of entity defined outside the XML document, typically pointing to external files or URLs. Attackers exploit XXE by injecting malicious external entities that an XML parser processes, which can lead to unauthorized reading of local or remote files, server-side request forgery (SSRF), denial of service (DoS), and even remote code execution.

## Entities in XML

*   **Internal Entities:** Defined and referenced within the same XML document using syntax like `<!ENTITY name "value">`.
*   **External Entities:** Defined outside the XML document and referenced within, often using a system identifier like `<!ENTITY name SYSTEM "URI">`.

## Document Type Definition (DTD)

DTD is a schema language that defines the structure and the allowable content of XML documents. It supports defining entities that can be reused in XML documents. These entities can be internal (defined inside the document) or external (referencing external resources). Attackers use DTDs to inject malicious external entities during XXE attacks.

### Example of an XXE Attack Payload

    <!DOCTYPE doc [ <!ENTITY phonebook SYSTEM "file:///path/to/phonebook.xml">
    ]>
    <doc>
    
    <header> &phonebook; </header> </doc> ```
    This example tries to include an external file from the server's file system into the XML response, potentially disclosing sensitive information.

  ### Types of XXE Attacks
  
*   **Local File Inclusion**: Reading files from a server's file system.
*   **Server-Side Request Forgery (SSRF)**: Making unauthorized requests to internal or external services.
*   **Blind Attacks**: Exploiting indirect XXE to exfiltrate data.
*   **Denial of Service (DoS)**: Causing resource exhaustion by including large or recursive entities.
*   **Remote Command Execution**: Execution of commands in some advanced exploitation scenarios.

### Prevention Measures
*   Disable DTD and external entity processing in XML parsers.
*   Use simpler data formats, such as JSON, when possible.
*   Strictly validate and sanitize all XML input.
*   Apply secure coding practices and keep libraries updated.

This comprehensive overview shows how XML's structured data format can introduce risks if XML parsers do not properly handle external entities, making XXE a critical vulnerability to guard against in applications processing XML data.


